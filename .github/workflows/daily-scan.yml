name: BIST Sequential Scanner (Ã–nerilen)

on:
  schedule:
    - cron: '55 6 * * 1-5'  # 09:55 TR
  workflow_dispatch:
  push:
    branches: [ main ]
    paths:
      - 'bist_scanner.py'
      - 'momentum_scanner.py'
      - '.github/workflows/daily-scan.yml'

jobs:
  sequential-scan:
    name: "ğŸ“Š SÄ±ralÄ± Tarama - Ä°ki Strateji"
    runs-on: ubuntu-latest
    timeout-minutes: 30
    
    steps:
    - name: Checkout Repository
      uses: actions/checkout@v4
    
    - name: Setup Python
      uses: actions/setup-python@v5
      with:
        python-version: '3.11'
        cache: 'pip'
    
    - name: Install Dependencies
      run: |
        python -m pip install --upgrade pip
        pip install pandas numpy matplotlib seaborn requests urllib3
    
    # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    # 1ï¸âƒ£ Ä°LK TARAMA: MOMENTUM (Daha hÄ±zlÄ±)
    # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    - name: "ğŸ¯ MOMENTUM TaramasÄ±"
      env:
        TELEGRAM_BOT_TOKEN: ${{ secrets.TELEGRAM_BOT_TOKEN }}
        TELEGRAM_CHAT_ID: ${{ secrets.TELEGRAM_CHAT_ID }}
      run: |
        echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
        echo "ğŸ¯ MOMENTUM STRATEJÄ°SÄ° BAÅLIYOR"
        echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
        python momentum_scanner.py
        echo ""
        echo "âœ… Momentum taramasÄ± tamamlandÄ±!"
        echo ""
    
    # KÄ±sa ara (Telegram rate limit iÃ§in)
    - name: "â¸ï¸ KÄ±sa Ara (10 saniye)"
      run: sleep 10
    
    # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    # 2ï¸âƒ£ Ä°KÄ°NCÄ° TARAMA: TAM Ã–ZELLÄ°KLÄ°
    # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    - name: "ğŸ” TAM Ã–ZELLÄ°KLÄ° Tarama"
      env:
        TELEGRAM_BOT_TOKEN: ${{ secrets.TELEGRAM_BOT_TOKEN }}
        TELEGRAM_CHAT_ID: ${{ secrets.TELEGRAM_CHAT_ID }}
      run: |
        echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
        echo "ğŸ” TAM Ã–ZELLÄ°KLÄ° TARAMA BAÅLIYOR"
        echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
        python bist_scanner.py
        echo ""
        echo "âœ… Tam tarama tamamlandÄ±!"
        echo ""
    
    # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    # SONUÃ‡LARI KAYDET
    # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    - name: "ğŸ“ SonuÃ§larÄ± Kaydet"
      if: always()
      uses: actions/upload-artifact@v4
      with:
        name: dual-scan-results-${{ github.run_number }}
        path: |
          momentum_scan.csv
          bist_scan_results.csv
          *.png
        retention-days: 30
    
    # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    # GIT COMMIT (Opsiyonel)
    # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    - name: "ğŸ’¾ Git Commit (Opsiyonel)"
      if: success()
      run: |
        git config --local user.email "action@github.com"
        git config --local user.name "BIST Scanner Bot"
        git add -f *.csv || true
        git commit -m "ğŸ“Š Dual scan - $(date +'%Y-%m-%d %H:%M')" || true
        git push || true
      continue-on-error: true
    
    # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    # Ã–ZET BÄ°LDÄ°RÄ°MÄ°
    # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    - name: "ğŸ“¢ Ã–zet Bildirimi"
      if: always()
      env:
        TELEGRAM_BOT_TOKEN: ${{ secrets.TELEGRAM_BOT_TOKEN }}
        TELEGRAM_CHAT_ID: ${{ secrets.TELEGRAM_CHAT_ID }}
      run: |
        python << 'EOF'
        import os
        import requests
        
        token = os.environ.get('TELEGRAM_BOT_TOKEN')
        chat_id = os.environ.get('TELEGRAM_CHAT_ID')
        
        if token and chat_id:
            message = """
ğŸ *HER Ä°KÄ° TARAMA TAMAMLANDI!*

âœ… Momentum Stratejisi
âœ… Tam Ã–zellikli Tarama

ğŸ“Š SonuÃ§lar Telegram'a gÃ¶nderildi
ğŸ“ CSV dosyalarÄ± oluÅŸturuldu
            """
            
            url = f"https://api.telegram.org/bot{token}/sendMessage"
            data = {
                'chat_id': chat_id,
                'text': message.strip(),
                'parse_mode': 'Markdown'
            }
            requests.post(url, data=data)
        EOF
